# Char Lab

キャラクターの360度からの画像を使って擬似的に3Dモデルっぽい表示をするソフトと、そのための画像を作るスクリプトです。

## 使い方

### 画像の準備

**すでに背景除去済みの画像がある場合はこの手順は不要です。**

背景除去が必要な場合は以下の手順でスクリプトを実行することで背景を除去することができます。
スクリプトの実行にはPythonの実行環境が必要です。Pythonの推奨バージョンは[.tool-versions](./.tool-versions)を参照してください。

背景除去は機械学習モデルを用いて行っています。そのため出力は完全ではなく、再実行によって結果が変わる可能性があります。
より良い結果を得るためには、以下のような画像を使用することが望ましいです。

- 背景が単色や単純な模様、あるいは抽出したいキャラクターよりもぼやけていること
- キャラクターの輪郭がはっきりしていること（キャラクターと背景とのコントラストが高いこと）
- 画像に対してキャラクターが大きく写っていること

#### 環境セットアップ

Pythonの実行環境にはPoetryで作成される仮想環境を使用します。

```bash
$ cd ./pre_process
$ pip install poetry
$ poetry install
```

#### スクリプトの実行

背景除去は `./pre_process/extract.py` を以下のコマンド実行で行うことができます。

```bash
$ poetry run python ./extract.py {画像ファイルまたはディレクトリのパス} {出力先ディレクトリのパス}
```

例えば、 `/path/to/input` にある画像を背景除去して `/path/to/output` に出力する場合は以下のように実行します。

```bash
$ poetry run python ./extract.py /path/to/input /path/to/output
```

入力パスと出力パスはそれぞれの環境に合わせて指定してください。
入力パスにはファイルとディレクトリどちらも指定できます。ディレクトリを指定した場合、ディレクトリ配下のすべての画像を対象として処理を行い、ディレクトリ構造を出力パスに反映させて処理した画像を出力します。ファイルを指定した場合は、単一の画像が処理されて出力ディレクトリの直下に出力されます。
出力先のディレクトリが存在しない場合には自動的に作成されます。出力先のディレクトリが存在していてファイルが存在する場合や、指定したパスがファイルである場合には警告が表示され、続行するかどうかを確認されます。続行をした場合同名のファイルが存在していた場合には上書きされます。
